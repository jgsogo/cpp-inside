<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>C++ Inside: Build once, run everywhere</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">
		
		<link href="fontawesome/css/all.css" rel="stylesheet">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- My CSS -->
		<link rel="stylesheet" href="css/custom.css">
		<link rel="stylesheet" href="css/histogram.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="my-header">
			</div>

			<div class="my-foot">
				<a class="github-button" href="https://github.com/jgsogo/cpp-inside/subscription" data-icon="octicon-eye" aria-label="Watch jgsogo/cpp-inside on GitHub">
					jgsogo/cpp-inside
				</a>
				<a class="twitter-share-button" rel="me" href="https://twitter.com/intent/tweet">
					<link rel="me" href="https://twitter.com/jgsogo">
					Tweet @jgsogo
				</a>
				<img class="img-inline" src="img/by-nc-sa.png">
				Javier G. Sogo | Senior software developer |
				<img class="img-inline" src="img/jfrog-logo.png"> JFrog LTD |
				<img class="img-inline" src="img/conan-logo.png"> Conan C/C++ Package Manager
			</div>

			<div class="slides">
				<!-- INTRO -->
				<section data-transition="convex" class="no-footer">
					<h1 class="lol">C++ Inside</h1>
					<h1><small>Build once, run everywhere</small></h1>
					
					<div class="speaker-conference">
						<img style="width: 50%;" data-src="img/codemotion-logo.png">
						<div class="conference">
							<hr/>
							<p>24-25 septiembre de 2019</p>	
							<p>Madrid, Espa√±a</p>
							<img class="img-inline" src="img/by-nc-sa.png">
						</div>
						<div class="middle"></div>
						<div class="speaker">
							<hr/>
							<p>Javier Garc√≠a Sogo</p>
							<p>
									C++/Python/DevOps... engineer
							</p>
							<p>
								<i class="fab fa-twitter"></i>
								<i class="fab fa-github"></i>
								&nbsp; @jgsogo
							</p>
						</div>
					</div>

					<aside class="notes" data-markdown>
						### Bienvenida
						###¬†Build == Compilar

						Qu√© significa eso de Build
					</aside>
				</section>

				<!-- ABOUT ME -->
				<section data-transition="convex" class="no-footer text-animation" data-slide-type="author" data-background-color="#414141">
					<h3>About me</h3>
					<img data-src="images/me.png" class="avatar"/>
					<p>Javier G. Sogo</p>
					<p>
						Software | 
						<span class="blue"><b>Conan.io</b></span> |
						<span class="green"><b>JFrog</b>&trade;</span>
					</p>
					<p>
						<small>
							<img data-src="img/github-logo.svg" class="brand-icon"/>jgsogo
								&nbsp;&nbsp;&nbsp;&nbsp; 
							<img data-src="img/twitter-logo.svg" class="brand-icon"/>@jgsogo
						</small>
					</p>
					<div class="text-animation-wrapper work-with" prefix="I work with ">
						<div style="display: none">
							<span>C++</span>
							<span>Python</span>
							<span>Jenkins</span>
							<span>C#</span>
							<span>Java</span>
							<span>üíö</span>
						</div>
						<p class="text-animation"></p>
					</div>
				</section>

				<!-- BUSINESS LOGIC ONCE -->
				<section data-transition="convex">
					<section class="no-footer">
						<h1>BUSINESS LOGIC</h1>
					</section>

					<section>
						<h2>One source of truth</h2>
						<p>Same algorithm</p>
						<p>Same bugs</p>
						<p>Better maintenance</p>
					</section>

					<section>
						<h2>Not always possible</h2>
						<p>Different programming languages</p>
						<p>Domain knowledge</p>
					</section>

					<section>
						<h2>Big problems, big solutions</h2>
						<p>Cross-platform languages</p>
						<p>Microservices</p>
					</section>
	
					<section data-background="images/frustation.png">
						<p class="spaceer">&nbsp;</p>
						<p class="spaceer">&nbsp;</p>
						<p class="spaceer">&nbsp;</p>
						<p class="spaceer">&nbsp;</p>
						<p class="spaceer">&nbsp;</p>
						<div class="box-shadow-white">
							<h2 class="black bold">Simple get complex</h2>
							<p class="black bold">Simple applications that turns into full architectures</p>
						</div>

						<aside class="notes" data-markdown>
							Aplicaciones simples que se convierten en arquitecturas complejas
							mezclando frameworks, tiempos de despliegue, problema de versiones
							y actualizaciones,...
						</aside>
					</section>

					<section data-background="images/monolith.jpg">
						<!-- Image source: https://goodhoodstore.com/mens/news/style-legacy-2001-a-space-odyssey-->
						<div class="credit black">Photo: https://goodhoodstore.com</div>
						<h2 class="box-shadow-black">Miss the monolith</h2>
					</section>
				</section>

				<!-- EXAMPLE: Random numbers -->
				<section data-transition="convex">
					<section class="no-footer">
						<h1>Example:</h1>
						<h2>Random number generator</h2>
					</section>

					<section data-background="images/dice.png" data-background-repeat="contain"  data-background-size="300px">
						<div class="left">
							<blockquote class="twitter-tweet" data-dnt="true" data-theme="light">
								<p lang="en" dir="ltr">First draft of my slides for <a href="https://twitter.com/CodemoMadrid?ref_src=twsrc%5Etfw">@CodemoMadrid</a>. I&#39;m planning to run a server and call to it from the actual slides in order to execute a DLL I&#39;ll have compiled live ü§Ø. Afraid of the demo effect? <br>üóìÔ∏è 24/09/2019 <a href="https://t.co/oZ5H8NQd2Z">pic.twitter.com/oZ5H8NQd2Z</a></p>&mdash; jgsogo (@jgsogo) <a href="https://twitter.com/jgsogo/status/1172911485204467713?ref_src=twsrc%5Etfw">September 14, 2019</a>
							</blockquote> 
						</div>	
						<div class="right">
							<h4>Random:</h4>
							<small>
								<i class="fas fa-dice" onclick="draft_one('jgsogo', '1172911485204467713');"></i>
								<span id="random-result"></span>
							</small>
							<div id="choosen"></div>
						</div>
					</section>

					<section data-background="images/dice.png" data-background-repeat="contain"  data-background-size="300px">
						<div class="left">
							<blockquote class="twitter-tweet" data-dnt="true" data-theme="light">
								<p lang="en" dir="ltr">First draft of my slides for <a href="https://twitter.com/CodemoMadrid?ref_src=twsrc%5Etfw">@CodemoMadrid</a>. I&#39;m planning to run a server and call to it from the actual slides in order to execute a DLL I&#39;ll have compiled live ü§Ø. Afraid of the demo effect? <br>üóìÔ∏è 24/09/2019 <a href="https://t.co/oZ5H8NQd2Z">pic.twitter.com/oZ5H8NQd2Z</a></p>&mdash; jgsogo (@jgsogo) <a href="https://twitter.com/jgsogo/status/1172911485204467713?ref_src=twsrc%5Etfw">September 14, 2019</a>
							</blockquote> 
						</div>	
						<div class="right">
							<h4>Pseudo-random:</h4>
							<small>
								<input id="seed" style="font-size:1em;" type="text" name="fname" placeholder="seed" maxlength="4" size="4">
								<i class="fas fa-dice" onclick="draft_one_seed('jgsogo', '1172911485204467713');"></i>
								<span id="random-result-seed"></span>
							</small>
							<div id="choosen-seed"></div>
						</div>
					</section>
	
					<section data-background="images/dice.png" data-background-repeat="contain"  data-background-size="300px">
						<h4>List of winners</h4>
						<div>
							<ul id="all-choosen"></ul>
						</div>
					</section>

					<section>
						<h2>AI: Simulation and modelling</h2>
						<img data-src="images/dilbert-random.jpg">
						<div class="credit">Image: DILBERT ¬© 2001 Scott Adams.</div>
						<p>
							<span class="fragment">Randomness</span>
							<span class="fragment">, reproducibility</span>
							<span class="fragment">, performance</span>
						</p>

						<aside class="notes" data-markdown>
							Cuando hablamos de AI-Simulaci√≥n hablamos de Montecarlo
						</aside>
					</section>

					<section data-background="images/neural.png" data-background-repeat="repeat"  data-background-size="1300px">
						<h2>Models are not easy</h2>
						<aside class="notes" data-markdown>
							Sencillo o no, la l√≥gica se puede copiar/pegar de un lenguaje a otro. Ser√° m√°s o
							menos mantenible, pero se puede reproducir. Es la definici√≥n de algoritmo.
						</aside>
					</section>

					<section data-state="darken" data-background="images/random-noise.png" data-background-repeat="repeat" data-background-size="300px">
						<h2>Neither random generators</h2>
						<aside class="notes" data-markdown>
							La realidad la codifico en una distribuci√≥n de probabilidad con ciertos par√°metros
							Generar n√∫meros aleatorios que satisfagan esos par√°metros
							Distribuciones conjuntas de probabilidad: c√≥pulas
						</aside>
					</section>

					<section data-state="darken" data-background="images/random-noise.png" data-background-repeat="repeat" data-background-size="300px">
						<h2>Neither random generators</h2>
						<p>Algorithm implementation</p>
						<p>Distribution sampling</p>
						<p>Floting point representation</p>
						<p>Reproducibility across different languages, compilers, runtimes...</p>

						<aside class="notes" data-markdown>
							Is the algorithm portable? ¬øEl lenguaje de destino puede hacer ciertas cosas?
							> Problemas de coma flotante
							> Crea tu propio algoritmo, ¬øes realmente aleatorio?
							> Vale para criptograf√≠a? An√°lisis espectral

							Link: https://stackoverflow.com/questions/24550963/stl-random-distributions-and-portability/24554535#24554535
						</aside>
					</section>

					<section data-background="images/montecarlo.png" data-background-repeat="contain">

						<aside class="notes" data-markdown>
							Simulaci√≥n de montecarlo:
								* BANCO: precio de accciones del mercado, uso intensivo de n¬∫ aleatorios
								* BANCO: conceder un pr√©stamo, regulaci√≥n, repetibilidad
						</aside>
					</section>

					<section>
						<img data-src="images/mario-bros.gif"/>
						<!--<h2>Slot machine</h2>-->

						<aside class="notes" data-markdown>
							Tragaperras: algoritmos validados y regulados por ley
						</aside>
					</section>

				</section>

				<!-- THE BIG PROBLEM -->
				<section data-transition="convex">
					<section class="no-footer">
						<h1>Challenge</h1>
						<h2>Unique business logic</h2>
					</section>

					<section>
						<h2>Love the monolith</h2>
						<p>Recycle/reuse the algorithm</p>
						<p>Reuse the random number generator</p>
					</section>

					<section data-background="images/aronofsky.jpg">
						<span class="credit">Photo: The Fountain (Aronofsky, 2006)</span>
						<h2>(Only) solution</h2>
						<p>Reuse the same binary</p>
					</section>
				</section>


				<!-- EXPERIMENTO / PROPUESTA -->
				<section data-transition="convex">
					<section class="no-footer">
						<h1>CHALLENGE ACCEPTED!</h1>
					</section>

					<section>
						<div class="histogram" id="histogram-form">
						</div>
						<p>
							<input id="histogram-form-n_samples" style="font-size:1em;" 
							       type="number" min="1" max="999999" step="1000" name="fname" value="999" maxlength="3" size="3">
							samples ~lognormal(
							<input id="histogram-form-mu" style="font-size:1em;" 
								   type="number" min="2.5" max="3.5" step="0.1" name="fname" value="3" maxlength="3" size="1">,
							<input id="histogram-form-sigma" style="font-size:1em;" 
								   type="number" min="0" max="0.5" step="0.1" name="fname" value="0.2" maxlength="3" size="2">	
							)
						</p>
					</section>
					<!--
					<section data-background-iframe="http://ghv.artzub.com/#repo=cpp-inside&user=jgsogo" data-background-interactive>
						<div style="position: absolute; width: 40%; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); color: #fff; padding: 5px; font-size: 20px; text-align: left;">
							<h2><img data-src="img/github-logo.svg" class="brand-icon"/> jgsogo/cpp-inside</h2>
							<p>Reusing C++ library from Java, Python, Rust, Go, C++, Javascript,...</p>
						</div>
					</section>
					-->
					<section class="no-footerr" data-background-video="video/cpp_inside.mp4" data-background-video-muted>
						<h2>Show me the code!</h2>
						<div style="box-shadow: 0 1px 4px rgba(0,0,0,0.8), 0 5px 25px rgba(0,0,0,0.5)">
							<h3 class="small-caps"><img data-src="img/github-logo.svg" class="brand-icon"/> jgsogo/cpp-inside</h3>
						</div>
					</section>

					<section>
						<h2>Building blocks</h2>
						<p>Native library</p>
						<p>Wrapper for every language</p>
						<p>Data interchange layer</p>
					</section>

					<section>
						<h2>Application</h2>
						<img class="is-transparent" data-src="images/wrapper-native.png">
					</section>

					<section>
						<h2>Application</h2>
						<img class="is-transparent" data-src="images/wrapper-native2.png">
						<aside class="notes" data-markdown>
							Not invented here
							Hourglass pattern
							Adi Shavit: Salami method
						</aside>
					</section>

					<section>
						<h2>Data interchange layer</h2>
						<div class="left">
							<img class="is-transparent" data-src="img/protobuf-logo.png">
							<h4>Protocol buffers</h4>
						</div>
						<div class="right">
							<p class="spacer"></p>
							<p>Language neutral</p>
							<p>Platform neutral</p>
							<p>Structured data</p>
							<p>Fast and reliable</p>
						</div>
					</section>

					<section>
						<h4>Data layer | Request samples</h4>
						<pre><code class="hljs" data-trim data-noescape data-line-numbers="8,11">
						message Model {
						    enum Name {
						        BERNOULLI = 0;
						        GEOMETRICAL = 5;
						        POISSON = 6;
						        EXPONENTIAL = 9;
						        BINOMIAL_NEGATIVE = 10;
						        LOGNORMAL = 11;
						    }
						    Name id = 1;
						    map< string, float> params = 2;
						}
						</code></pre>
						<pre><code class="hljs" data-trim data-noescape data-line-numbers="2,3">
						message SampleRequest {
						    Model model = 1;
						    float seed = 2;
						    uint32 n_samples = 3;
						}	
						</code></pre>
					</section>

					<section>
						<h4>Data layer | Samples returned</h4>
						<pre><code class="hljs" data-trim data-noescape data-line-numbers="2, 4">
						message Sample {
						    Model model = 1;
						    float seed = 2;
						    repeated float samples = 3;
						}	
						</code></pre>
					</section>

					<section>
						<h2>C interface</h2>
						<pre><code class="hljs" data-trim data-line-numbers="2,10-12,14">
						#ifdef __cplusplus
						extern "C" {
						#endif
						    typedef void (*callback_t)(void* state, 
						                               const void* data,
						                               const void* status);
						
						    CRND_EXPORT void help(void* state, 
						                          callback_t help_callback);
						    CRND_EXPORT void sample(void* state,
						                            const void* sample_request,
						                            callback_t sample_callback);
						#ifdef __cplusplus
						}
						#endif
						</code></pre>
					</section>

					<section>
						<h4>C interface | Sample function</h4>
						<pre><code class="hljs" data-trim data-line-numbers="5-7">
						typedef void (*callback_t)(void* state, 
						                           const void* data,
						                           const void* status);

						void sample(void* state,
						            const void* sample_request,
						            callback_t sample_callback);
						</code></pre>
						<table>
							<tbody>
								<tr><td><span class="bold">state</span></td><td>caller context</td></tr>
								<tr><td><span class="bold">sample_request</span></td><td>request message</td></tr>
								<tr><td><span class="bold">sample_callback</span></td><td>function callback</td></tr>
							</tbody>
						</table>
					</section>

					<section>
						<h4>C interface | Sample function</h4>
						<pre><code class="hljs cpp" data-trim data-line-numbers="1-2,5-6,8,11-13">
						void sample(void* state, const void* sample_request,
						            callback_t sample_callback) {
						    SPDLOG_DEBUG("> C::sample");
					
						    SampleRequest request = 
						        Serialized< SampleRequest>::parse(sample_request);
						    Sample sample_message;
						    auto status = sample(request, sample_message);
					
						    SPDLOG_TRACE("C::sample::before callback");
						    sample_callback(state,
						                    Serialized< crnd::Sample>(sample_message),
						                    Serialized< crnd::Status>(*status));
						    SPDLOG_TRACE("C::sample::after callback");
							
						    SPDLOG_DEBUG("< C::sample");
						}
						</code></pre>
						<p>sample_request >> (sample) >> sample_message </p>
					</section>
	
					<section>
						<h4>C interface | Callback</h4>
						<img class="is-transparent" data-src="images/wrapper-callback.png">
					</section>

					<section>
						<div class="text-animation-wrapper" prefix="" delay="10", timeout="50">
							<h2>Wrapper for</h2>
							<h2 class="text-animation"></h2>
							<div style="display: none">
								<span>C++</span>
								<span>Python</span>
								<span>Java</span>
								<span>Rust</span>
								<span>Go</span>
								<span>NodeJS</span>
								<span>JavaScript*</span>
							</div>
							<p></p>
							<ol>
								<li class="fragment">Load the native library</li>
								<li class="fragment">Map interface functions (sample)</li>
								<li class="fragment">Build and serialize the proto message</li>
								<li class="fragment">Call the function</li>
								<li class="fragment">Deserialize the response</li>
							</ol>
						</div>
					</section>

					<section data-transition="fade-out">
						<h4>Wrapper for Python</h4>
						<pre><code class="hljs python" data-trim data-noescape data-line-numbers="4-6">
						import ctypes
						from messages import status_pb2, sample_request_pb2, sample_pb2, model_pb2

						class CRND:
						    def __init__(self, path_to_library):
						        self.dll = ctypes.cdll.LoadLibrary(path_to_library)

						    def lognormal(self, seed, samples, mu, sigma):
						        model = model_pb2.Model()
						        model.id = model_pb2.Model.LOGNORMAL
						        model.params["mu"] = mu
						        model.params["sigma"] = sigma
						        return self._sample(seed, samples, model)

						    def _sample(self, seed, samples, model):
						        request = sample_request_pb2.SampleRequest()
						        request.seed = seed
						        request.n_samples = samples
						        request.model.CopyFrom(model)
						
						        serialized = ProtoSerialized.build_from(request)
						        sample, status = _call(self.dll.sample,
						                               sample_pb2.Sample,
						                               serialized.as_ref())
						
						        if not status.ok:
						            raise Exception(status.error_message)
						
						        return sample.samples
						</code></pre>
					</section>

					<section data-transition="fade-in fade-out">
						<h4>Wrapper for Python</h4>
						<pre><code class="hljs python" data-trim data-noescape data-line-numbers="4, 8-13">
						import ctypes
						from messages import status_pb2, sample_request_pb2, sample_pb2, model_pb2

						class CRND:
						    def __init__(self, path_to_library):
						        self.dll = ctypes.cdll.LoadLibrary(path_to_library)

						    def lognormal(self, seed, samples, mu, sigma):
						        model = model_pb2.Model()
						        model.id = model_pb2.Model.LOGNORMAL
						        model.params["mu"] = mu
						        model.params["sigma"] = sigma
						        return self._sample(seed, samples, model)

						    def _sample(self, seed, samples, model):
						        request = sample_request_pb2.SampleRequest()
						        request.seed = seed
						        request.n_samples = samples
						        request.model.CopyFrom(model)
						
						        serialized = ProtoSerialized.build_from(request)
						        sample, status = _call(self.dll.sample,
						                               sample_pb2.Sample,
						                               serialized.as_ref())
						
						        if not status.ok:
						            raise Exception(status.error_message)
						
						        return sample.samples
						</code></pre>
					</section>

					<section data-transition="fade-in">
						<h4>Wrapper for Python</h4>
						<pre><code class="hljs python" data-trim data-noescape data-line-numbers="4, 15-21, 25-29">
						import ctypes
						from messages import status_pb2, sample_request_pb2, sample_pb2, model_pb2

						class CRND:
						    def __init__(self, path_to_library):
						        self.dll = ctypes.cdll.LoadLibrary(path_to_library)

						    def lognormal(self, seed, samples, mu, sigma):
						        model = model_pb2.Model()
						        model.id = model_pb2.Model.LOGNORMAL
						        model.params["mu"] = mu
						        model.params["sigma"] = sigma
						        return self._sample(seed, samples, model)

						    def _sample(self, seed, samples, model):
						        request = sample_request_pb2.SampleRequest()
						        request.seed = seed
						        request.n_samples = samples
						        request.model.CopyFrom(model)
						
						        serialized = ProtoSerialized.build_from(request)
						<mark>        sample, status = _call(self.dll.sample,         </mark>
						<mark>                               sample_pb2.Sample,       </mark>
						<mark>                               serialized.as_ref())     </mark>
						
						        if not status.ok:
						            raise Exception(status.error_message)
						
						        return sample.samples
						</code></pre>
					</section>

					<section data-transition="fade-out">
						<h4>Wrapper for Python</h4>
						<pre><code class="hljs python" data-trim data-noescape data-line-numbers="1, 8">
						def _call(func, response_class, sample_request):
						    @ctypes.CFUNCTYPE(None, ctypes.c_void_p, ctypes.POINTER(ProtoSerialized), ctypes.POINTER(ProtoSerialized))
						    def cb(_, data_in, status_in):
						        cb.status = status_in.contents.parse_as(Status)
						        if cb.status.ok:
						            cb.data = data_in.contents.parse_as(response_class)

						    func(None, sample_request, cb)  # No need to pass context

						    if cb.status.ok:
						        return cb.data, cb.status
						    else:
						        return None, cb.status
						</code></pre>
					</section>

					<section data-transition="fade-in fade-out">
						<h4>Wrapper for Python</h4>
						<pre><code class="hljs python" data-trim data-noescape data-line-numbers="2-6">
						def _call(func, response_class, sample_request):
						    @ctypes.CFUNCTYPE(None, ctypes.c_void_p, ctypes.POINTER(ProtoSerialized), ctypes.POINTER(ProtoSerialized))
						    def cb(_, data_in, status_in):
						        cb.status = status_in.contents.parse_as(Status)
						        if cb.status.ok:
						            cb.data = data_in.contents.parse_as(response_class)

						    func(None, sample_request, cb)  # No need to pass context

						    if cb.status.ok:
						        return cb.data, cb.status
						    else:
						        return None, cb.status
						</code></pre>
					</section>

					<section data-transition="fade-out">
						<h4>Wrapper for Python</h4>
						<pre><code class="hljs python" data-trim data-noescape data-line-numbers="10-13">
						def _call(func, response_class, sample_request):
						    @ctypes.CFUNCTYPE(None, ctypes.c_void_p, ctypes.POINTER(ProtoSerialized), ctypes.POINTER(ProtoSerialized))
						    def cb(_, data_in, status_in):
						        cb.status = status_in.contents.parse_as(Status)
						        if cb.status.ok:
						            cb.data = data_in.contents.parse_as(response_class)

						    func(None, sample_request, cb)  # No need to pass context

						    if cb.status.ok:
						        return cb.data, cb.status
						    else:
						        return None, cb.status
						</code></pre>
					</section>

					<section>
						<i class="fab fa-node fa-2x" onclick="nodejs_histogram('histogram-nodejs');"></i>
						<div class="histogram" id="histogram-nodejs">
						</div>
						<small>
							<input id="histogram-nodejs-n_samples" oninput="nodejs_histogram('histogram-nodejs');" 
							       type="number" min="1" max="999999" step="1000" style="font-size:1em;" name="fname" value="100000" maxlength="6" size="7">
							samples ~lognormal(
							<input id="histogram-nodejs-mu" oninput="nodejs_histogram('histogram-nodejs');"
								   type="number" min="2.5" max="3.5" step="0.1" style="font-size:1em;" name="fname" value="3" maxlength="3" size="1">,
							<input id="histogram-nodejs-sigma" oninput="nodejs_histogram('histogram-nodejs');"
								   type="number" min="0" max="0.5" step="0.1" style="font-size:1em;" name="fname" value="0.2" maxlength="3" size="2">	
							) | Seed: 
							<input id="histogram-nodejs-seed" oninput="nodejs_histogram('histogram-nodejs');"
							       type="number" min="1" max="99999" step="1" style="font-size:1em;" name="fname" value="12345" maxlength="5" size="5">	
						</small>
					</section>

					<section data-background-iframe="http://localhost:8000/stream" data-background-color="#ffffff">
						<div style="width: 7%;" class="right">
							<img data-src="img/java-logo.png" class="is-transparent is-plain" onclick="run_language('java');"></br>
							<img data-src="img/python-logo.png" class="is-transparent is-plain" onclick="run_language('python');"></br>
							<img data-src="img/cpp-logo.png" class="is-transparent is-plain" onclick="run_language('cpp');"></br>
							<img data-src="img/go-logo.png" class="is-transparent is-plain" onclick="run_language('go');"></br>
							<img data-src="img/rust-logo.png" class="is-transparent is-plain" onclick="run_language('rust');"></br>
							<img data-src="img/nodejs-logo.png" class="is-transparent is-plain" onclick="run_language('nodejs');"></br>
						</div>
					</section>

					<section>
						<h2>Try it yourself</h2>
						<p><img data-src="img/github-logo.svg" class="brand-icon"/>&nbsp;&nbsp;&nbsp;&nbsp;jgsogo/cpp-inside</p>
						<img class="is-transparent" data-src="images/ghost-in-the-shell.gif">
						<p>
							<small>
								<img data-src="img/cpp-logo.png" class="brand-icon"/>&nbsp;&nbsp;&nbsp;&nbsp; 
								<img data-src="img/java-logo.png" class="brand-icon"/>&nbsp;&nbsp;&nbsp;&nbsp; 
								<img data-src="img/python-logo.png" class="brand-icon"/>&nbsp;&nbsp;&nbsp;&nbsp; 
								<img data-src="img/rust-logo.png" class="brand-icon"/>&nbsp;&nbsp;&nbsp;&nbsp; 
								<img data-src="img/go-logo.png" class="brand-icon"/>&nbsp;&nbsp;&nbsp;&nbsp; 
								<img data-src="img/javascript-logo.png" class="brand-icon"/>&nbsp;&nbsp;&nbsp;&nbsp; 
								<img data-src="img/nodejs-white-logo.png" class="brand-icon"/>&nbsp;&nbsp;&nbsp;&nbsp; 
							</small>
						</p>
					</section>

				</section>

				<!-- CONCLUSIONES -->
				<section data-transition="convex">
					<section class="no-footer">
						<h1>CONCLUSIONS</h1>
					</section>

					<section data-background="images/down-of-man.jpg">
						<span class="credit">Photo: Dawn of Man (Marko Manev, 2013)</span>
						<h2>Love the monolith</h2>
						<ul>
							<li>Solid, simpler, faster</li>
							<li>Easy to test</li>
							<li>Consistent deploy</li>
							<li>No extra complexity</li>
						</ul>
					</section>

					<section data-state="darken" data-background="images/cppcon.jpeg">
						<span class="credit">Photo: CppCon 2019 (Hana Dus√≠kov√°, 16/09/2019)</span>
						<h2>Why C++ inside?</h2>
						<ul>
							<li>Compile to native library (call from any language)</li>
							<li>Easy and powerful language</li>
							<li>Ecosystem is improving quickly</li>
							<li>Worldwide community (and Madrid)</li>
						</ul>
					</section>

				</section>
				
				<!-- WHAT's NEXT -->
				<section data-transition="convex">
					<section class="no-footer">
						<h1>TODO List</h1>
						<p>Document the examples</p>
						<p>Add more languages (PR welcome)</p>
						<p>Add CI/CD system</p>
					</section>
				</section>

				<!-- THE END -->
				<section data-transition="convex" class="no-footer" data-background="images/the-end.gif" data-background-size="contain" data-background-color="#000000">
				</section>
			</div>
		</div>

		<script src="js/reveal.js"></script>
		<script src="js/jquery-3.4.1.min.js"></script>
		<script src="js/custom.js"></script>
		<script src="js/text-animation.js"></script>
		<script src="js/twitter.js"></script>
		<script src="js/seedrandom.js"></script>
		<script src="js/d3.v3.min.js"></script>
		<script src="js/d3-random.v2.min.js"></script>
		<script src="js/histogram.js"></script>

		<!-- Social buttons -->
		<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
		<script async defer src="https://buttons.github.io/buttons.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				history: true,
				slideNumber: true,
				previewLinks: true,
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true },
				]
			});

			Reveal.addEventListener( 'ready', function( event ) {
				setTimeout(function () {
					footer_visibility(event.currentSlide, Reveal.isSpeakerNotes());
				}, 100);
			});

			var histogram_nodejs = null;

			var animated_elements = []
			var animated_histograms = []
			Reveal.addEventListener( 'slidechanged', function( event ) {
				setTimeout(function () {
					footer_visibility(event.currentSlide, Reveal.isSpeakerNotes());
				}, 100);

				// Start text-animation
				animated_elements.forEach(function(elem) {elem.stop = true;});
				animated_elements.length = 0;
				$(event.currentSlide).find(".text-animation-wrapper").each(function(){
					var data = animate_element($(this));
					animated_elements.push(data);
				});

				// Run histograms
				animated_histograms.forEach(function(elem) {elem.stop = true;});
				animated_histograms.length = 0;
				$(event.currentSlide).find(".histogram").each(function() {
					let id = $(this).attr("id");
					$(this).empty();
					if (id === "histogram-form") {
						var data = animate_histogram(id, function(){
							// Get lognormal params
							let mu = parseFloat($("#histogram-form-mu").val());
							let sigma = parseFloat($("#histogram-form-sigma").val());
							let n_samples = parseFloat($("#histogram-form-n_samples").val());
							// Use javascript d3 to generate the samples
							var random = d3.randomLogNormal(mu, sigma);
    						var values = d3.range(n_samples).map(random);
    						return values
						});
						animated_histograms.push(data);
					}
					else if (id === "histogram-nodejs") {
						histogram_nodejs = initialize_histogram(id, function(){return [10, 20, 30, 40];}, false);
					}
				});
			});

			function nodejs_histogram(id) {
				console.log("NodeJS histogram");
				let seed = parseFloat($("#histogram-nodejs-seed").val() || 12345);;
				let mu = parseFloat($("#histogram-nodejs-mu").val());
				let sigma = parseFloat($("#histogram-nodejs-sigma").val());
				let n_samples = parseFloat($("#histogram-nodejs-n_samples").val());

				//let n_samples = 100000;
				//let mu = 3;
				//let sigma = 0.2;
				$.get({
					url: "crnd/lognormal",
					data: {'seed': seed, 'n_samples': n_samples, 'mu': mu, 'sigma': sigma}
				}).done(function(data) {
					var json = $.parseJSON(data);
					refresh(histogram_nodejs, function(){return json});
				});
			}

			function run_language(language) {
				var stream_iframe = $(".slide-background.present").find("iframe");
				let url = "http://localhost:8000/stream?language=" + language;
				stream_iframe.attr("src", url);
			}
		</script>
	</body>
</html>
